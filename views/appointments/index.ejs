<%- include('../partials/header') %>
<h1>My Appointments</h1>

<form class="card form" action="/appointments" method="post">
  <div class="row">
    <label>Doctor
      <select name="doctor" required>
        <option value="">Select…</option>
        <% doctors.forEach(d => { %>
          <option value="<%= d._id %>"><%= d.fullName %> — <%= d.specialty %></option>
        <% }) %>
      </select>
    </label>

    <label>Date
      <input type="date" name="date" required>
    </label>

    <label>Time (AM/PM)
      <select name="time12" required>
        <option value="">Select time…</option>
        <% (slots || []).forEach(s => { %>
          <option value="<%= s %>"><%= s %></option>
        <% }) %>
      </select>
      <small class="muted">30-minute slots • AM/PM</small>
    </label>
  </div>

  <label>Notes<textarea name="notes" rows="2"></textarea></label>
  <button class="btn">Book appointment</button>
</form>

<div class="list">
  <% if (!appts.length) { %>
    <p class="muted">No appointments yet.</p>
  <% } %>
  <% appts.forEach(a => { %>
    <div class="card list-item">
      <div>
        <h3><%= a.doctor?.fullName %> — <%= a.doctor?.specialty %></h3>
        <p class="muted">
          <%= new Date(a.startsAt).toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' }) %>
          →
          <%= new Date(a.endsAt).toLocaleTimeString(undefined, { timeStyle: 'short' }) %>
        </p>
        <% if (a.notes) { %><p><%= a.notes %></p><% } %>
      </div>
      <div class="actions">
        <a class="btn-out" href="/appointments/<%= a._id %>/edit">Edit</a>
        <form action="/appointments/<%= a._id %>/delete" method="post" onsubmit="return confirm('Cancel this appointment?');">
          <button class="btn-danger">Cancel</button>
        </form>
      </div>
    </div>
  <% }) %>
</div>
<%- include('../partials/footer') %>